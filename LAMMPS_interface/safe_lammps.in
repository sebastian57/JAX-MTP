#Test Zero Overhead JAX-MTP Implementation
units metal
atom_style atomic
boundary s s s
newton on

# Read structure
read_data bulk_ni3al_small.data
replicate 3 3 3 
#read_data bulk_ni3al_small_tiny.data
#replicate 1 1 1
# Set masses (Al and Ni) - Fixed mapping: type 0->1 (Al), type 1->2 (Ni)

mass 2 26.98  # Al (type 1 in LAMMPS)
mass 1 58.69  # Ni (type 2 in LAMMPS)

variable        temperature     equal   100

#reset_atoms id
#velocity all create ${temperature} 12345

neighbor 5.0 bin
neigh_modify every 2 delay 10 check yes page 100000

#neighbor 5.0 bin
#neigh_modify every 1 delay 0 check yes
#run 0

#neigh_modify one 1  # full neighbor list

#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_2889_400.bin 2889 400 5.0 0
pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_856_60.bin 856 60 5.0 0
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_856_400.bin 856 400 5.0 1
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_107_60.bin 107 60 5.0 0
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_2889_60.bin 2889 60 5.0 0
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_6848_60.bin 6848 60 5.0 0
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_13375_60.bin 13375 60 5.0 0
#pair_style jax/mtp_zero_overhead_original ../compilation/jax_functions_corrected/jax_potential_corrected_ultra_cuda_23112_60.bin 23112 60 5.0 0
pair_coeff * *

#fix relax all box/relax iso 0.0 vmax 0.001
#minimize 1.0e-6 1.0e-8 1000 10000
#unfix relax
#reset_timestep 0

#fix 1 all npt temp ${temperature} ${temperature} 0.1 x 0 0 1 y 0 0 1
fix 1 all nvt temp ${temperature} ${temperature} 0.1

# Output settings  
thermo 1
thermo_style custom step pe ke temp press vol atoms fmax fnorm cpu 

#dump peratom all custom 1 dump_peratom.txt id type x y z fx fy fz

dump mydump all custom 100 dump.out id type x y z

# Run just one step to check forces
run 2000

print "Zero overhead test complete!"
